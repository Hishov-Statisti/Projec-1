---
title: "Project 1 - Alon Goodman & Ran Hassid"
output:
  html_document:
    df_print: paged
---

# Q1 - Snakes & Ladders #

## The Board Game ##

```{r}
Start_of_Ladder <- c(2,7,8,15,21,28,36,51,71,78,87)
End_of_Ladder <- c(38,14,31,26,42,84,44,66,91,98,94)
Start_of_Snake <- c(16,46,49,62,64,74,89,92,99)
End_of_Snake <- c(6,25,11,19,60,53,68,88,80)
```



## Auxiliary Function - Sum of Digit ##

```{r}
digitsum <- function(n) {
  while(n>=10){
  n <-n %% 10 + floor(n / 10)
  }
  return(n)
  }
```

## One game Function ##

1. Rolling the dice.
2. Check if we crossed the 100 and go back.
3. Check if the final sum of digits is equal to value of the dice.
4. Handle the snakes and ladders.

```{r}
Sanke_and_Ladder <- function(Start_of_Ladder,End_of_Ladder,Start_of_Snake,End_of_Snake){
  Snake <- data.frame(Start_of_Snake,End_of_Snake)
  Ladder <- data.frame(Start_of_Ladder,End_of_Ladder)
  number_of_rolls <- 0
  counter <- 1
  while(counter < 100){
    dice_roll <- sample(1:6,1) 
    number_of_rolls <-  number_of_rolls + 1
    counter <- counter + dice_roll
    if (counter > 100){
      dif <- counter - 100
      counter <- 100 - dif
      }
    if (digitsum(counter) == dice_roll){
      counter <- floor(counter/2)
      }
    if  (any(counter==Snake$Start_of_Snake)==T){
      counter <- Snake$End_of_Snake[Snake$Start_of_Snake == counter]}
    if  (any(counter==Ladder$Start_of_Ladder)==T){
      counter <- Ladder$End_of_Ladder[Ladder$Start_of_Ladder == counter]}
    }
  return (number_of_rolls)
}
```

## The Simulation ##
```{r}
Sanke_and_Ladder_sim <- replicate(5000,Sanke_and_Ladder(Start_of_Ladder,End_of_Ladder,Start_of_Snake,End_of_Snake))
```

### The Expected value ###
```{r}
mu <- mean(Sanke_and_Ladder_sim)
mu
```

### Confidance Interval of 95% - CLT ###
```{r}
sd <- sqrt(var(Sanke_and_Ladder_sim)/5000)
up <- mu + qnorm(0.975)*sd
low <- mu - qnorm(0.975)*sd
CI <- c(low,up)
CI
```

# Q2 - X & O #


# Q3 - Dogcatia #

1. r - counter for the turn - total
2. r.d - counter for dogs in the turn
3. r.c - counter for cats in the turn
4. X - dogs come - Poisson(lambda=3)
5. Y - cats come - Poisson(lambda=1.5) - a cat enter the turn if and only if r=0   
6. X.1 - dogs service - exp(mu=3)
7. Y.1 - cats service - exp(mu=5)
8. Only one server - one animal is served at time
9. p.d - profit from dog - 1, damage from dog - 0.1
10. p.c - profit from cat - 3
11. total time - 12 hours = 720 minutes. t.counter - clock counter

```{r}
dogcatia <- function(){
  ## function does.... input... output..
  
  # initialization
  work.clock <- 0 # clock counter
  is.bunny.available <- TRUE
  mat.queue <- matrix(data = NA,nrow = 0,ncol = 3)
  
  dog.served.counter <- 0 # counter for dogs that was served
  dog.not.served.counter <- 0 # counter for dogs that was not served
  cat.served.counter <- 0 # counter for cats that was served
  cat.not.served.counter <- 0 # counter for cats that was not served
  
  serve_start_time <- 0
  serve_end_time <- 0
  
  #r <- 0 # counter for the  total turn
  #r.d <- 0 # counter for dogs in the turn
  #r.c <- 0 # counter for cats in the turn
  
  #p.d <- 0 # profit from dog
  #p.c <- 0 # profit from cat
  
  
  ## data
  dogs.arrive.time <- numeric(0)
  while (sum(dogs.arrive.time)<720) {
    dogs.arrive.time <- c(dogs.arrive.time,rexp(n = 1,rate = 3))
  }
  dogs.arrive.time <- cumsum(x = dogs.arrive.time) # dogs arrive time 
  dogs.serve.time <- rexp(n = dogs.arrive.time,rate = 3) # potential serve time for each dog.
  
  cats.arrive.time <- numeric(0)
  while (sum(cats.arrive.time)<720) {
    cats.arrive.time <- c(cats.arrive.time,rexp(n = 1,rate = 1.5))
  }
  cats.arrive.time <- cumsum(x = cats.arrive.time) # cats arrive time
  cats.serve.time <- rexp(n = cats.arrive.time,rate = 5) # potential serve time for each cat.
  ## end
  

  
  print(sum(dogs.arrive.time<7))
  
  while(work.clock < 7) {
  #print(serve_end_time)
  #print(dogs.arrive.time[1])
  #print(mat.queue)
    
    if (dogs.arrive.time[1] < cats.arrive.time[1]) {
      next_to_queue <- c("dog",dogs.arrive.time[1],dogs.serve.time[1])
      dogs.arrive.time <- dogs.arrive.time[-1]
      dogs.serve.time <- dogs.serve.time[-1]
    } else {
      next_to_queue <- c("cat",cats.arrive.time[1],cats.serve.time[1])
      cats.arrive.time <- cats.arrive.time[-1]
      cats.serve.time <- cats.serve.time[-1]
    }
    
    
    while (ifelse(test = length(mat.queue) > 0, 
                  yes = work.clock + as.numeric(mat.queue[1,2]) < next_to_queue[2],
                  no = FALSE)){
      if(next_to_queue[1] == "dog"){
      serve_end_time <- work.clock + as.numeric(mat.queue[1,3])
      dog.served.counter <- dog.served.counter + 1
    } else {
      serve_end_time <- work.clock + as.numeric(mat.queue[1,3])
      cat.served.counter <- cat.served.counter + 1
    }
      mat.queue <- matrix(data = mat.queue[-1,],ncol = 3)
    }
    
    
    if(next_to_queue[1] == "dog"){
      serve_end_time <- work.clock + as.numeric(next_to_queue[3])
      dog.served.counter <- dog.served.counter + 1
    } else {
      serve_end_time <- work.clock + as.numeric(next_to_queue[3])
      cat.served.counter <- cat.served.counter + 1
    }
    
    
    while (next_to_queue[2] < serve_end_time) {
      if (next_to_queue[1] == "dog") {
      if (length(mat.queue[,1]) >= 10) {
        dog.not.served.counter <- dog.not.served.counter + 1
      } else { mat.queue <- rbind(mat.queue,next_to_queue) }
    }
    if (next_to_queue[1] == "cat") {
      if (length(mat.queue[,1]) > 0) {
        cat.not.served.counter <- cat.not.served.counter + 1
      } else { mat.queue <- rbind(mat.queue,next_to_queue) }
    }
     
      if (dogs.arrive.time[1] < cats.arrive.time[1]) {
      next_to_queue <- c("dog",dogs.arrive.time[1],dogs.serve.time[1])
      dogs.arrive.time <- dogs.arrive.time[-1]
      dogs.serve.time <- dogs.serve.time[-1]
      } else {
      next_to_queue <- c("cat",cats.arrive.time[1],cats.serve.time[1])
      cats.arrive.time <- cats.arrive.time[-1]
      cats.serve.time <- cats.serve.time[-1]
    }
    }
    work.clock <- serve_end_time
    
  }
  return(c(dog.served.counter,dog.not.served.counter))
}
    
    dogcatia()
    #################################
    
    if (next_to_queue[1] == "dog") {
      if (is.bunny.available){
        #is.bunny.available <- FALSE
        serve_end_time <- serve_func(next_to_queue,work.clock)
        }
      else {
        queue_func(mat.queue,next_to_queue) # update queue
      }
      }
    if (next_to_queue[1] == "cat") {
      if (is.bunny.available){
        #is.bunny.available <- FALSE
        serve_end_time <- serve_func(next_to_queue,work.clock)
        }
      else {
        queue_func(mat.queue,next_to_queue) # update queue
      }
    }
    
    if (serve_end_time <= min(dogs.arrive.time[1],cats.arrive.time[1])) {
      work.clock <- serve_end_time
      next_to_queue <- next_to_queue_func(dogs.arrive.time,dogs.serve.time,cats.arrive.time,cats.serve.time)
      queue_func(mat.queue,next_to_queue)
      }
    else {
      next_to_queue <- next_to_queue_func(dogs.arrive.time,dogs.serve.time,cats.arrive.time,cats.serve.time)
      while (serve_end_time > next_to_queue[2]) {
        queue_func(mat.queue,next_to_queue)
        next_to_queue <- next_to_queue_func(dogs.arrive.time,dogs.serve.time,cats.arrive.time,cats.serve.time)
        }
      work.clock <- serve_end_time
    }
    
  }
  profit.from.dog <- 1*dog.served.counter - 0.1*dog.not.served.counter
  profit.from.cat <- 3*cat.served.counter
  
  return(c(dog.served.counter, dog.not.served.counter, profit.from.dog, cat.served.counter,cat.not.served.counter,  
           profit.from.cat))
}


dogcatia()







# functions
  next_to_queue_func <- function(dogs.arrive.time,dogs.serve.time,cats.arrive.time,cats.serve.time){
    if (dogs.arrive.time[1] < cats.arrive.time[1]) {
      next_to_queue <- c("dog",dogs.arrive.time[1],dogs.serve.time[1])
      dogs.arrive.time <- dogs.arrive.time[-1]
      dogs.serve.time <- dogs.serve.time[-1]
    }
    else {
      next_to_queue <- c("cat",cats.arrive.time[1],cats.serve.time[1])
      cats.arrive.time <- cats.arrive.time[-1]
      cats.serve.time <- cats.serve.time[-1]
    }
    
    return(next_to_queue)
  }
  
  serve_func <- function(next_to_queue,serve_start_time){
    if(next_to_queue[1] == "dog"){
      serve_end_time <- serve_start_time + as.numeric(next_to_queue[3])
      dog.served.counter <- dog.served.counter + 1
      is.bunny.available <- TRUE
    }
    else {
      serve_end_time <- serve_start_time + as.numeric(next_to_queue[3])
      cat.served.counter <- cat.served.counter + 1
      is.bunny.available <- TRUE
    }
    return(serve_end_time)
  }
  
  queue_func <- function(mat.queue,next_to_queue){
    if (next_to_queue[1] == "dog") {
      if (length(mat.queue[,1]) == 10) {
        dog.not.served.counter <- dog.not.served.counter + 1
      }
      else {
        mat.queue <- rbind(mat.queue,next_to_queue)
      }
      
    }
    if (next_to_queue[1] == "cat") {
      if (length(mat.queue[,1]) > 0) {
        cat.not.served.counter <- cat.not.served.counter + 1
      }
      else {
        mat.queue <- rbind(mat.queue,next_to_queue)
      }
    }
    return(mat.queue)
  }
  
  
  # queue initialization
  next_to_queue <- next_to_queue_func(dogs.arrive.time,dogs.serve.time,cats.arrive.time,cats.serve.time)


```








```{r}
z <- c(1:10)
z.1 <- c(rep("0",5),rep("1",5))
g <- data.frame(z,z.1)
g[1,1] <- 2
g[1,2] <- "dog"
g[2,1] <- 2
g[2,2] <- "cat"
g
g <- g[-c(1),]
g
g[nrow(g)+1,] <- c(0,"0")
g <- g[c(1:10),]

```



```{r}

animal_comes <- func() {
   x <- rpois(1,3)
   y <- rpois(1,1.5)
   if (y<=x){
     if (r>0){
       r.c.n <- r.c.n + 1
       }else{
         r.c <- r.c + 1
         turn_df[r+1,r+1] <-  "cat"
         t.counter <- t.counter + y
         }
     if(r<10){
       r.d <- r.d + 1
       turn_df[r+1,r+1] <- "dog"
       t.counter <- t.counter + x
       }else{
         r.d.n <- r.d.n + 1
       }
     }
   if (y>x){
     if(r<10){
       r.d <- r.d + 1
       turn_df[r+1,r+1] <- "dog"
       t.counter <- t.counter + x
       }else{
        r.d.n <- r.d.n + 1
        }
     if (r>0){
       r.c.n <- r.c.n + 1
       }else{
         r.c <- r.c + 1
         turn_df[r+1,r+1] <-  "cat"
         t.counter <- t.counter + y
       }
   }
   }




while(t<720){
    # an animal comes
    x <- rpois(1,3)
    y <- rpois(1,1.5)
    if(r<10){
      r.d <- r.d + 1
      turn_df[r+1,r+1] <- "dog"
      t.counter <- t.counter + x
      }else{
        r.d.n <- r.d.n + 1
        }
    if (r>0){
      r.c.n <- r.c.n + 1
    }else{
      r.c <- r.c + 1
      turn_df[r+1,r+1] <-  "cat"
      t.counter <- t.counter + y
      }
  }
    # server an animal
    if(turn_df[1,1]=="dog"){
      x.1 <- rexp(1,3)
    }
  
```

